(this.webpackJsonpstreamlit_component_template=this.webpackJsonpstreamlit_component_template||[]).push([[0],{19:function(e,t,n){e.exports=n(27)},27:function(e,t,n){"use strict";n.r(t);var a=n(8),r=n.n(a),o=n(17),i=n.n(o),s=n(4),c=n.n(s),d=n(5),l=n(6),u=n(0),p=n(1),f=n(2),m=n(3),g=n(9),b=function(e){Object(f.a)(n,e);var t=Object(m.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).canvasRef=void 0,a.sessionId=void 0,a.recordingId=void 0,a.generateRecordingId=function(){return"rec_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)},a.drawWaveform=function(){if(a.state.analyser&&a.canvasRef.current){var e=a.canvasRef.current,t=e.getContext("2d"),n=a.state.analyser.frequencyBinCount,r=new Uint8Array(n);!function o(){if(a.state.isRecording){var i=requestAnimationFrame(o);if(a.setState({animationId:i}),a.state.analyser.getByteTimeDomainData(r),t){t.fillStyle="#f0f0f0",t.fillRect(0,0,e.width,e.height);var s=t.createLinearGradient(0,0,e.width,0);s.addColorStop(0,"#ff4b4b"),s.addColorStop(1,"#ff8b8b"),t.lineWidth=3,t.strokeStyle=s,t.beginPath();for(var c=1*e.width/n,d=0,l=e.height/2,u=0;u<n;u++){var p=r[u]/128*e.height/2;if(0===u)t.moveTo(d,p);else{var f=(d+(d-c))/2;t.quadraticCurveTo(d-c,l,f,p)}l=p,d+=c}t.lineTo(e.width,e.height/2),t.stroke()}}else a.state.animationId&&cancelAnimationFrame(a.state.animationId)}()}},a.startRecording=Object(l.a)(c.a.mark((function e(){var t,n,r,o,i,s,u,p;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a.recordingId=a.generateRecordingId(),e.next=4,navigator.mediaDevices.getUserMedia({audio:{channelCount:1,sampleRate:44100,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});case 4:t=e.sent,n=new AudioContext,r=n.createMediaStreamSource(t),o=n.createAnalyser(),r.connect(o),i=new MediaRecorder(t,{mimeType:"audio/webm;codecs=opus",audioBitsPerSecond:128e3}),5e3,s=[],u=0,i.ondataavailable=function(e){e.data.size>0&&(s.push(e.data),a.setState((function(t){return{previewChunks:[].concat(Object(d.a)(t.previewChunks),[e.data])}})))},p=setInterval(Object(l.a)(c.a.mark((function e(){var t,n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(s.length>0&&a.state.isRecording)){e.next=8;break}return t=new Blob(s,{type:"audio/webm;codecs=opus"}),s=[],e.next=5,t.arrayBuffer();case 5:n=e.sent,r=new Uint8Array(n),g.a.setComponentValue({arr:Object.fromEntries(r.entries()),chunkId:u++,sessionId:a.sessionId,recordingId:a.recordingId,isFinal:!1});case 8:case"end":return e.stop()}}),e)}))),5e3),i.onstop=Object(l.a)(c.a.mark((function e(){var t,n,r,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(clearInterval(p),!(s.length>0)){e.next=8;break}return t=new Blob(s,{type:"audio/webm;codecs=opus"}),e.next=5,t.arrayBuffer();case 5:n=e.sent,r=new Uint8Array(n),g.a.setComponentValue({arr:Object.fromEntries(r.entries()),chunkId:u,sessionId:a.sessionId,recordingId:a.recordingId,isFinal:!0});case 8:o=new Blob(a.state.previewChunks,{type:"audio/webm;codecs=opus"}),a.setState({chunks:[],previewChunks:[],isRecording:!1,mediaRecorder:null,audioBlob:o,audioUrl:URL.createObjectURL(o)});case 10:case"end":return e.stop()}}),e)}))),i.start(100),a.setState({mediaRecorder:i,isRecording:!0,analyser:o,previewChunks:[],audioUrl:null,audioBlob:null},a.drawWaveform),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(0),console.error("Error accessing microphone:",e.t0);case 23:case"end":return e.stop()}}),e,null,[[0,20]])}))),a.stopRecording=function(){a.state.mediaRecorder&&a.state.isRecording&&(a.state.mediaRecorder.stop(),a.state.mediaRecorder.stream.getTracks().forEach((function(e){return e.stop()})),a.state.animationId&&cancelAnimationFrame(a.state.animationId))},a.resetRecording=function(){a.state.animationId&&cancelAnimationFrame(a.state.animationId),a.state.audioUrl&&URL.revokeObjectURL(a.state.audioUrl),a.recordingId=a.generateRecordingId(),a.setState({isRecording:!1,audioBlob:null,chunks:[],previewChunks:[],audioUrl:null,audioData:null,analyser:null,animationId:null}),g.a.setComponentValue({type:"reset",sessionId:a.sessionId,recordingId:a.recordingId})},a.downloadRecording=function(){if(a.state.audioBlob){var e=(new Date).toLocaleString().replace(/[\s,]/g,"").replace(/_/g,""),t="streamlit_audio_".concat(e,".webm"),n=document.createElement("a");n.style.display="none",n.href=URL.createObjectURL(a.state.audioBlob),n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n)}},a.render=function(){var e={};if(a.props.theme){var t="1px solid ".concat(a.state.isRecording?"#ff4b4b":"#e0e0e0");e.border=t,e.outline=t}return r.a.createElement("div",{style:{padding:"20px",background:"white",borderRadius:"10px",boxShadow:"0 2px 10px rgba(0,0,0,0.1)"}},r.a.createElement("canvas",{ref:a.canvasRef,width:"500",height:"100",style:{width:"100%",marginBottom:"20px",borderRadius:"5px",backgroundColor:a.state.isRecording?"#fff4f4":"#f0f0f0"}}),r.a.createElement("div",{style:{display:"flex",gap:"10px",justifyContent:"center",flexWrap:"wrap"}},a.state.isRecording?r.a.createElement("button",{onClick:a.stopRecording,style:{padding:"10px 20px",borderRadius:"5px",border:"none",backgroundColor:"#4b4bff",color:"white",cursor:"pointer"}},"Stop Recording"):r.a.createElement("button",{onClick:a.startRecording,style:{padding:"10px 20px",borderRadius:"5px",border:"none",backgroundColor:"#ff4b4b",color:"white",cursor:"pointer"}},"Start Recording"),a.state.audioUrl&&r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{onClick:a.resetRecording,style:{padding:"10px 20px",borderRadius:"5px",border:"none",backgroundColor:"#ff8c4b",color:"white",cursor:"pointer"}},"Reset Recording"),r.a.createElement("audio",{src:a.state.audioUrl,controls:!0,style:{marginTop:"10px",width:"100%"}}))))},a.state={isRecording:!1,mediaRecorder:null,audioBlob:null,chunks:[],audioUrl:null,audioData:null,analyser:null,animationId:null,previewChunks:[]},a.canvasRef=r.a.createRef(),a.sessionId="session_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),a.recordingId=a.generateRecordingId(),a}return Object(p.a)(n,[{key:"componentDidMount",value:function(){if(this.canvasRef.current){var e=this.canvasRef.current,t=e.getContext("2d");if(t){t.fillStyle="#f0f0f0",t.fillRect(0,0,e.width,e.height);var n=t.createLinearGradient(0,0,e.width,0);n.addColorStop(0,"#ff4b4b"),n.addColorStop(1,"#ff8b8b"),t.strokeStyle=n,t.lineWidth=3,t.beginPath(),t.moveTo(0,e.height/2),t.lineTo(e.width,e.height/2),t.stroke()}}}},{key:"componentWillUnmount",value:function(){this.state.animationId&&cancelAnimationFrame(this.state.animationId)}}]),n}(g.b),h=Object(g.c)(b);g.a.setComponentReady(),g.a.setFrameHeight(),i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(h,null)),document.getElementById("root"))}},[[19,1,2]]]);
//# sourceMappingURL=main.854d8e71.chunk.js.map