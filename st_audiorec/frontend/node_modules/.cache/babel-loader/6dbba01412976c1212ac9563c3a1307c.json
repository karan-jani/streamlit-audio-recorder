{"ast":null,"code":"import _regeneratorRuntime from\"/home/jani/readout_bot/libs/streamlit-audio-recorder/st_audiorec/frontend/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"/home/jani/readout_bot/libs/streamlit-audio-recorder/st_audiorec/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"/home/jani/readout_bot/libs/streamlit-audio-recorder/st_audiorec/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _createClass from\"/home/jani/readout_bot/libs/streamlit-audio-recorder/st_audiorec/frontend/node_modules/@babel/runtime/helpers/esm/createClass\";import _classCallCheck from\"/home/jani/readout_bot/libs/streamlit-audio-recorder/st_audiorec/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _inherits from\"/home/jani/readout_bot/libs/streamlit-audio-recorder/st_audiorec/frontend/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/jani/readout_bot/libs/streamlit-audio-recorder/st_audiorec/frontend/node_modules/@babel/runtime/helpers/esm/createSuper\";import{Streamlit,StreamlitComponentBase,withStreamlitConnection}from\"streamlit-component-lib\";import React from\"react\";var StreamlitAudioRecorder=/*#__PURE__*/function(_StreamlitComponentBa){_inherits(StreamlitAudioRecorder,_StreamlitComponentBa);var _super=_createSuper(StreamlitAudioRecorder);function StreamlitAudioRecorder(props){var _this;_classCallCheck(this,StreamlitAudioRecorder);_this=_super.call(this,props);_this.startRecording=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var stream,mediaRecorder;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return navigator.mediaDevices.getUserMedia({audio:{channelCount:1,sampleRate:44100,echoCancellation:true,noiseSuppression:true,autoGainControl:true}});case 3:stream=_context.sent;mediaRecorder=new MediaRecorder(stream,{mimeType:'audio/webm',audioBitsPerSecond:128000});mediaRecorder.ondataavailable=function(e){if(e.data.size>0){_this.setState(function(prev){return{chunks:[].concat(_toConsumableArray(prev.chunks),[e.data])};});}};mediaRecorder.onstop=function(){var audioBlob=new Blob(_this.state.chunks,{type:'audio/webm'});// First update UI state\n_this.setState({chunks:[],audioBlob:audioBlob,isRecording:false,mediaRecorder:null});// Convert blob to array buffer for more reliable transfer\naudioBlob.arrayBuffer().then(function(buffer){var uint8Array=new Uint8Array(buffer);Streamlit.setComponentValue(uint8Array);});};mediaRecorder.start(250);_this.setState({mediaRecorder:mediaRecorder,isRecording:true});_context.next=14;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](0);console.error(\"Error accessing microphone:\",_context.t0);case 14:case\"end\":return _context.stop();}}},_callee,null,[[0,11]]);}));_this.stopRecording=function(){if(_this.state.mediaRecorder&&_this.state.isRecording){_this.state.mediaRecorder.stop();_this.state.mediaRecorder.stream.getTracks().forEach(function(track){return track.stop();});}};_this.resetRecording=function(){_this.setState({isRecording:false,audioBlob:null,chunks:[]});Streamlit.setComponentValue(null);};_this.downloadRecording=function(){if(_this.state.audioBlob){var datetime=new Date().toLocaleString().replace(/[\\s,]/g,'').replace(/_/g,'');var filename=\"streamlit_audio_\".concat(datetime,\".webm\");var a=document.createElement('a');a.style.display='none';a.href=URL.createObjectURL(_this.state.audioBlob);a.download=filename;document.body.appendChild(a);a.click();document.body.removeChild(a);}};_this.render=function(){var theme=_this.props.theme;var style={};if(theme){var borderStyling=\"1px solid \".concat(_this.state.isRecording?theme.primaryColor:\"gray\");style.border=borderStyling;style.outline=borderStyling;}return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"button\",{id:\"record\",onClick:_this.state.isRecording?_this.stopRecording:_this.startRecording,style:style},_this.state.isRecording?'Stop Recording':'Start Recording'),/*#__PURE__*/React.createElement(\"button\",{id:\"reset\",onClick:_this.resetRecording,style:style},\"Reset\"),/*#__PURE__*/React.createElement(\"button\",{id:\"download\",onClick:_this.downloadRecording,style:style},\"Download\"),_this.state.audioBlob&&/*#__PURE__*/React.createElement(\"audio\",{id:\"audio\",controls:true,src:URL.createObjectURL(_this.state.audioBlob)}));};_this.state={isRecording:false,mediaRecorder:null,audioBlob:null,chunks:[]};return _this;}return _createClass(StreamlitAudioRecorder);}(StreamlitComponentBase);export default withStreamlitConnection(StreamlitAudioRecorder);Streamlit.setComponentReady();Streamlit.setFrameHeight();","map":{"version":3,"sources":["/home/jani/readout_bot/libs/streamlit-audio-recorder/st_audiorec/frontend/src/StreamlitAudioRecorder.tsx"],"names":["Streamlit","StreamlitComponentBase","withStreamlitConnection","React","StreamlitAudioRecorder","props","startRecording","navigator","mediaDevices","getUserMedia","audio","channelCount","sampleRate","echoCancellation","noiseSuppression","autoGainControl","stream","mediaRecorder","MediaRecorder","mimeType","audioBitsPerSecond","ondataavailable","e","data","size","setState","prev","chunks","onstop","audioBlob","Blob","state","type","isRecording","arrayBuffer","then","buffer","uint8Array","Uint8Array","setComponentValue","start","console","error","stopRecording","stop","getTracks","forEach","track","resetRecording","downloadRecording","datetime","Date","toLocaleString","replace","filename","a","document","createElement","style","display","href","URL","createObjectURL","download","body","appendChild","click","removeChild","render","theme","borderStyling","primaryColor","border","outline","setComponentReady","setFrameHeight"],"mappings":"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","sourcesContent":["import {\n  Streamlit,\n  StreamlitComponentBase,\n  withStreamlitConnection,\n} from \"streamlit-component-lib\"\nimport React, { ReactNode } from \"react\"\n\ninterface State {\n  isRecording: boolean\n  mediaRecorder: MediaRecorder | null\n  audioBlob: Blob | null\n  chunks: Blob[]\n}\n\nclass StreamlitAudioRecorder extends StreamlitComponentBase {\n  constructor(props: any) {\n    super(props)\n    this.state = {\n      isRecording: false,\n      mediaRecorder: null,\n      audioBlob: null,\n      chunks: []\n    }\n  }\n\n  startRecording = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({\n        audio: {\n          channelCount: 1,\n          sampleRate: 44100,\n          echoCancellation: true,\n          noiseSuppression: true,\n          autoGainControl: true\n        }\n      })\n\n      const mediaRecorder = new MediaRecorder(stream, {\n        mimeType: 'audio/webm',\n        audioBitsPerSecond: 128000\n      })\n\n      mediaRecorder.ondataavailable = (e: BlobEvent) => {\n        if (e.data.size > 0) {\n          this.setState((prev: State) => ({\n            chunks: [...prev.chunks, e.data]\n          }))\n        }\n      }\n\n      mediaRecorder.onstop = () => {\n        const audioBlob = new Blob(this.state.chunks, { type: 'audio/webm' })\n        \n        // First update UI state\n        this.setState({ \n          chunks: [], \n          audioBlob,\n          isRecording: false,\n          mediaRecorder: null\n        })\n        \n        // Convert blob to array buffer for more reliable transfer\n        audioBlob.arrayBuffer().then(buffer => {\n          const uint8Array = new Uint8Array(buffer)\n          Streamlit.setComponentValue(uint8Array)\n        })\n      }\n\n      mediaRecorder.start(250)\n      this.setState({ mediaRecorder, isRecording: true })\n\n    } catch (err) {\n      console.error(\"Error accessing microphone:\", err)\n    }\n  }\n\n  stopRecording = () => {\n    if (this.state.mediaRecorder && this.state.isRecording) {\n      this.state.mediaRecorder.stop()\n      this.state.mediaRecorder.stream.getTracks().forEach((track: MediaStreamTrack) => track.stop())\n    }\n  }\n\n  resetRecording = (): void => {\n    this.setState({\n      isRecording: false,\n      audioBlob: null,\n      chunks: []\n    })\n    Streamlit.setComponentValue(null)\n  }\n\n  downloadRecording = (): void => {\n    if (this.state.audioBlob) {\n      const datetime = new Date().toLocaleString()\n        .replace(/[\\s,]/g, '')\n        .replace(/_/g, '')\n      const filename = `streamlit_audio_${datetime}.webm`\n\n      const a = document.createElement('a')\n      a.style.display = 'none'\n      a.href = URL.createObjectURL(this.state.audioBlob)\n      a.download = filename\n      document.body.appendChild(a)\n      a.click()\n      document.body.removeChild(a)\n    }\n  }\n\n  public render = (): ReactNode => {\n    const theme = this.props.theme\n    const style: React.CSSProperties = {}\n\n    if (theme) {\n      const borderStyling = `1px solid ${\n        this.state.isRecording ? theme.primaryColor : \"gray\"\n      }`\n      style.border = borderStyling\n      style.outline = borderStyling\n    }\n\n    return (\n      <div>\n        <button \n          id=\"record\" \n          onClick={this.state.isRecording ? this.stopRecording : this.startRecording}\n          style={style}\n        >\n          {this.state.isRecording ? 'Stop Recording' : 'Start Recording'}\n        </button>\n        <button id=\"reset\" onClick={this.resetRecording} style={style}>\n          Reset\n        </button>\n        <button id=\"download\" onClick={this.downloadRecording} style={style}>\n          Download\n        </button>\n        {this.state.audioBlob && (\n          <audio\n            id=\"audio\"\n            controls\n            src={URL.createObjectURL(this.state.audioBlob)}\n          />\n        )}\n      </div>\n    )\n  }\n}\n\nexport default withStreamlitConnection(StreamlitAudioRecorder)\n\nStreamlit.setComponentReady()\nStreamlit.setFrameHeight()\n"]},"metadata":{},"sourceType":"module"}