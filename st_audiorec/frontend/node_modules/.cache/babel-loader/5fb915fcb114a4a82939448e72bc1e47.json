{"ast":null,"code":"import _regeneratorRuntime from\"/home/jani/readout_bot/libs/streamlit-audio-recorder/st_audiorec/frontend/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/jani/readout_bot/libs/streamlit-audio-recorder/st_audiorec/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/home/jani/readout_bot/libs/streamlit-audio-recorder/st_audiorec/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/jani/readout_bot/libs/streamlit-audio-recorder/st_audiorec/frontend/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/jani/readout_bot/libs/streamlit-audio-recorder/st_audiorec/frontend/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/jani/readout_bot/libs/streamlit-audio-recorder/st_audiorec/frontend/node_modules/@babel/runtime/helpers/esm/createSuper\";import{Streamlit,StreamlitComponentBase,withStreamlitConnection}from\"streamlit-component-lib\";import React from\"react\";var StreamlitAudioRecorder=/*#__PURE__*/function(_StreamlitComponentBa){_inherits(StreamlitAudioRecorder,_StreamlitComponentBa);var _super=_createSuper(StreamlitAudioRecorder);function StreamlitAudioRecorder(props){var _this;_classCallCheck(this,StreamlitAudioRecorder);_this=_super.call(this,props);_this.chunks=[];_this.audioContext=null;_this.analyser=null;_this.animationId=null;_this.canvasRef=void 0;_this.drawWaveform=function(){if(!_this.canvasRef.current||!_this.analyser)return;var canvas=_this.canvasRef.current;var canvasCtx=canvas.getContext('2d');if(!canvasCtx)return;var bufferLength=_this.analyser.frequencyBinCount;var dataArray=new Uint8Array(bufferLength);var draw=function draw(){_this.animationId=requestAnimationFrame(draw);_this.analyser.getByteTimeDomainData(dataArray);canvasCtx.fillStyle='rgb(200, 200, 200)';canvasCtx.fillRect(0,0,canvas.width,canvas.height);canvasCtx.lineWidth=2;canvasCtx.strokeStyle='rgb(0, 0, 0)';canvasCtx.beginPath();var sliceWidth=canvas.width*1.0/bufferLength;var x=0;for(var i=0;i<bufferLength;i++){var v=dataArray[i]/128.0;var y=v*canvas.height/2;if(i===0){canvasCtx.moveTo(x,y);}else{canvasCtx.lineTo(x,y);}x+=sliceWidth;}canvasCtx.lineTo(canvas.width,canvas.height/2);canvasCtx.stroke();};draw();};_this.startRecording=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var stream,source,mediaRecorder;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return navigator.mediaDevices.getUserMedia({audio:{channelCount:1,sampleRate:44100,echoCancellation:true,noiseSuppression:true,autoGainControl:true}});case 3:stream=_context.sent;// Set up audio context and analyser for visualization\n_this.audioContext=new AudioContext();source=_this.audioContext.createMediaStreamSource(stream);_this.analyser=_this.audioContext.createAnalyser();_this.analyser.fftSize=2048;source.connect(_this.analyser);mediaRecorder=new MediaRecorder(stream,{mimeType:'audio/webm',audioBitsPerSecond:128000});_this.chunks=[];mediaRecorder.ondataavailable=function(e){if(e.data.size>0){_this.chunks.push(e.data);}};mediaRecorder.onstop=function(){var blob=new Blob(_this.chunks,{type:'audio/webm'});var audioUrl=URL.createObjectURL(blob);// Convert blob to ArrayBuffer for Streamlit\nblob.arrayBuffer().then(function(buffer){var uint8Array=new Uint8Array(buffer);Streamlit.setComponentValue(uint8Array);});// Update UI state\n_this.setState({audioBlob:blob,audioUrl:audioUrl,isRecording:false,mediaRecorder:null});// Clean up visualization\nif(_this.animationId){cancelAnimationFrame(_this.animationId);}};mediaRecorder.start(100);_this.setState({mediaRecorder:mediaRecorder,isRecording:true});_this.drawWaveform();_context.next=22;break;case 18:_context.prev=18;_context.t0=_context[\"catch\"](0);console.error(\"Error accessing microphone:\",_context.t0);Streamlit.setComponentValue(null);case 22:case\"end\":return _context.stop();}}},_callee,null,[[0,18]]);}));_this.stopRecording=function(){if(_this.state.mediaRecorder&&_this.state.isRecording){_this.state.mediaRecorder.stop();_this.state.mediaRecorder.stream.getTracks().forEach(function(track){return track.stop();});if(_this.audioContext){_this.audioContext.close();}}};_this.resetRecording=function(){if(_this.state.mediaRecorder){_this.state.mediaRecorder.stream.getTracks().forEach(function(track){return track.stop();});}if(_this.audioContext){_this.audioContext.close();}if(_this.animationId){cancelAnimationFrame(_this.animationId);}_this.chunks=[];_this.setState({isRecording:false,audioBlob:null,audioUrl:null,mediaRecorder:null,audioData:[]});Streamlit.setComponentValue(null);};_this.render=function(){var theme=_this.props.theme;var style={};if(theme){var borderStyling=\"1px solid \".concat(_this.state.isRecording?theme.primaryColor:\"gray\");style.border=borderStyling;style.outline=borderStyling;}return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"div\",{style:{marginBottom:'1rem'}},/*#__PURE__*/React.createElement(\"button\",{id:\"record\",onClick:_this.state.isRecording?_this.stopRecording:_this.startRecording,style:style},_this.state.isRecording?'Stop Recording':'Start Recording'),/*#__PURE__*/React.createElement(\"button\",{id:\"reset\",onClick:_this.resetRecording,style:style,disabled:_this.state.isRecording},\"Reset\")),/*#__PURE__*/React.createElement(\"canvas\",{ref:_this.canvasRef,width:\"300\",height:\"100\",style:{display:_this.state.isRecording?'block':'none',border:'1px solid #ccc',marginBottom:'1rem'}}),_this.state.audioUrl&&/*#__PURE__*/React.createElement(\"audio\",{id:\"audio\",controls:true,src:_this.state.audioUrl,style:{width:'100%'}}));};_this.state={isRecording:false,mediaRecorder:null,audioBlob:null,audioUrl:null,audioData:[]};_this.canvasRef=React.createRef();return _this;}_createClass(StreamlitAudioRecorder,[{key:\"componentWillUnmount\",value:function componentWillUnmount(){if(this.animationId){cancelAnimationFrame(this.animationId);}if(this.audioContext){this.audioContext.close();}}}]);return StreamlitAudioRecorder;}(StreamlitComponentBase);export default withStreamlitConnection(StreamlitAudioRecorder);Streamlit.setComponentReady();Streamlit.setFrameHeight();","map":{"version":3,"sources":["/home/jani/readout_bot/libs/streamlit-audio-recorder/st_audiorec/frontend/src/StreamlitAudioRecorder.tsx"],"names":["Streamlit","StreamlitComponentBase","withStreamlitConnection","React","StreamlitAudioRecorder","props","chunks","audioContext","analyser","animationId","canvasRef","drawWaveform","current","canvas","canvasCtx","getContext","bufferLength","frequencyBinCount","dataArray","Uint8Array","draw","requestAnimationFrame","getByteTimeDomainData","fillStyle","fillRect","width","height","lineWidth","strokeStyle","beginPath","sliceWidth","x","i","v","y","moveTo","lineTo","stroke","startRecording","navigator","mediaDevices","getUserMedia","audio","channelCount","sampleRate","echoCancellation","noiseSuppression","autoGainControl","stream","AudioContext","source","createMediaStreamSource","createAnalyser","fftSize","connect","mediaRecorder","MediaRecorder","mimeType","audioBitsPerSecond","ondataavailable","e","data","size","push","onstop","blob","Blob","type","audioUrl","URL","createObjectURL","arrayBuffer","then","buffer","uint8Array","setComponentValue","setState","audioBlob","isRecording","cancelAnimationFrame","start","console","error","stopRecording","state","stop","getTracks","forEach","track","close","resetRecording","audioData","render","theme","style","borderStyling","primaryColor","border","outline","marginBottom","display","createRef","setComponentReady","setFrameHeight"],"mappings":"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","sourcesContent":["import {\n  Streamlit,\n  StreamlitComponentBase,\n  withStreamlitConnection,\n} from \"streamlit-component-lib\"\nimport React, { ReactNode } from \"react\"\n\ninterface State {\n  isRecording: boolean\n  mediaRecorder: MediaRecorder | null\n  audioBlob: Blob | null\n  audioUrl: string | null\n  audioData: number[]\n}\n\nclass StreamlitAudioRecorder extends StreamlitComponentBase {\n  private chunks: Blob[] = [];\n  private audioContext: AudioContext | null = null;\n  private analyser: AnalyserNode | null = null;\n  private animationId: number | null = null;\n  private canvasRef: React.RefObject<HTMLCanvasElement>;\n\n  constructor(props: any) {\n    super(props)\n    this.state = {\n      isRecording: false,\n      mediaRecorder: null,\n      audioBlob: null,\n      audioUrl: null,\n      audioData: []\n    }\n    this.canvasRef = React.createRef();\n  }\n\n  componentWillUnmount() {\n    if (this.animationId) {\n      cancelAnimationFrame(this.animationId);\n    }\n    if (this.audioContext) {\n      this.audioContext.close();\n    }\n  }\n\n  drawWaveform = () => {\n    if (!this.canvasRef.current || !this.analyser) return;\n\n    const canvas = this.canvasRef.current;\n    const canvasCtx = canvas.getContext('2d');\n    if (!canvasCtx) return;\n\n    const bufferLength = this.analyser.frequencyBinCount;\n    const dataArray = new Uint8Array(bufferLength);\n\n    const draw = () => {\n      this.animationId = requestAnimationFrame(draw);\n      this.analyser!.getByteTimeDomainData(dataArray);\n\n      canvasCtx.fillStyle = 'rgb(200, 200, 200)';\n      canvasCtx.fillRect(0, 0, canvas.width, canvas.height);\n      canvasCtx.lineWidth = 2;\n      canvasCtx.strokeStyle = 'rgb(0, 0, 0)';\n      canvasCtx.beginPath();\n\n      const sliceWidth = canvas.width * 1.0 / bufferLength;\n      let x = 0;\n\n      for (let i = 0; i < bufferLength; i++) {\n        const v = dataArray[i] / 128.0;\n        const y = v * canvas.height / 2;\n\n        if (i === 0) {\n          canvasCtx.moveTo(x, y);\n        } else {\n          canvasCtx.lineTo(x, y);\n        }\n\n        x += sliceWidth;\n      }\n\n      canvasCtx.lineTo(canvas.width, canvas.height / 2);\n      canvasCtx.stroke();\n    };\n\n    draw();\n  };\n\n  startRecording = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({\n        audio: {\n          channelCount: 1,\n          sampleRate: 44100,\n          echoCancellation: true,\n          noiseSuppression: true,\n          autoGainControl: true\n        }\n      });\n\n      // Set up audio context and analyser for visualization\n      this.audioContext = new AudioContext();\n      const source = this.audioContext.createMediaStreamSource(stream);\n      this.analyser = this.audioContext.createAnalyser();\n      this.analyser.fftSize = 2048;\n      source.connect(this.analyser);\n\n      const mediaRecorder = new MediaRecorder(stream, {\n        mimeType: 'audio/webm',\n        audioBitsPerSecond: 128000\n      });\n\n      this.chunks = [];\n\n      mediaRecorder.ondataavailable = (e: BlobEvent) => {\n        if (e.data.size > 0) {\n          this.chunks.push(e.data);\n        }\n      };\n\n      mediaRecorder.onstop = () => {\n        const blob = new Blob(this.chunks, { type: 'audio/webm' });\n        const audioUrl = URL.createObjectURL(blob);\n        \n        // Convert blob to ArrayBuffer for Streamlit\n        blob.arrayBuffer().then(buffer => {\n          const uint8Array = new Uint8Array(buffer);\n          Streamlit.setComponentValue(uint8Array);\n        });\n\n        // Update UI state\n        this.setState({\n          audioBlob: blob,\n          audioUrl: audioUrl,\n          isRecording: false,\n          mediaRecorder: null\n        });\n\n        // Clean up visualization\n        if (this.animationId) {\n          cancelAnimationFrame(this.animationId);\n        }\n      };\n\n      mediaRecorder.start(100);\n      this.setState({ mediaRecorder, isRecording: true });\n      this.drawWaveform();\n\n    } catch (err) {\n      console.error(\"Error accessing microphone:\", err);\n      Streamlit.setComponentValue(null);\n    }\n  };\n\n  stopRecording = () => {\n    if (this.state.mediaRecorder && this.state.isRecording) {\n      this.state.mediaRecorder.stop();\n      this.state.mediaRecorder.stream.getTracks().forEach((track: MediaStreamTrack) => track.stop());\n      if (this.audioContext) {\n        this.audioContext.close();\n      }\n    }\n  };\n\n  resetRecording = (): void => {\n    if (this.state.mediaRecorder) {\n      this.state.mediaRecorder.stream.getTracks().forEach((track: MediaStreamTrack) => track.stop());\n    }\n    if (this.audioContext) {\n      this.audioContext.close();\n    }\n    if (this.animationId) {\n      cancelAnimationFrame(this.animationId);\n    }\n    this.chunks = [];\n    this.setState({\n      isRecording: false,\n      audioBlob: null,\n      audioUrl: null,\n      mediaRecorder: null,\n      audioData: []\n    });\n    Streamlit.setComponentValue(null);\n  };\n\n  public render = (): ReactNode => {\n    const theme = this.props.theme;\n    const style: React.CSSProperties = {};\n\n    if (theme) {\n      const borderStyling = `1px solid ${\n        this.state.isRecording ? theme.primaryColor : \"gray\"\n      }`;\n      style.border = borderStyling;\n      style.outline = borderStyling;\n    }\n\n    return (\n      <div>\n        <div style={{ marginBottom: '1rem' }}>\n          <button \n            id=\"record\" \n            onClick={this.state.isRecording ? this.stopRecording : this.startRecording}\n            style={style}\n          >\n            {this.state.isRecording ? 'Stop Recording' : 'Start Recording'}\n          </button>\n          <button \n            id=\"reset\" \n            onClick={this.resetRecording} \n            style={style}\n            disabled={this.state.isRecording}\n          >\n            Reset\n          </button>\n        </div>\n        \n        <canvas \n          ref={this.canvasRef} \n          width=\"300\" \n          height=\"100\" \n          style={{ \n            display: this.state.isRecording ? 'block' : 'none',\n            border: '1px solid #ccc',\n            marginBottom: '1rem'\n          }}\n        />\n        \n        {this.state.audioUrl && (\n          <audio\n            id=\"audio\"\n            controls\n            src={this.state.audioUrl}\n            style={{ width: '100%' }}\n          />\n        )}\n      </div>\n    );\n  }\n}\n\nexport default withStreamlitConnection(StreamlitAudioRecorder);\n\nStreamlit.setComponentReady();\nStreamlit.setFrameHeight();\n"]},"metadata":{},"sourceType":"module"}